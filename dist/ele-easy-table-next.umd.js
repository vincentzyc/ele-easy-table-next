(function(e,i){typeof exports=="object"&&typeof module<"u"?module.exports=i(require("vue"),require("element-plus"),require("vuedraggable")):typeof define=="function"&&define.amd?define(["vue","element-plus","vuedraggable"],i):(e=typeof globalThis<"u"?globalThis:e||self,e["ele-easy-table-next"]=i(e.Vue,e["ElementPlus "],e.vuedraggable))})(this,function(e,i,S){"use strict";const x=e.defineComponent({name:"EleEasyTable",components:{ElForm:i.ElForm,ElFormItem:i.ElFormItem,ElDatePicker:i.ElDatePicker,ElInput:i.ElInput,ElSelect:i.ElSelect,ElOption:i.ElOption,ElTable:i.ElTable,ElTableColumn:i.ElTableColumn,ElButton:i.ElButton,ElPagination:i.ElPagination},props:{formData:{type:Object,default:()=>({})},form:{type:Object,default:()=>({})},table:{type:Object,default:()=>({list:[]})},pagination:{type:[Boolean,Object],default:!0}},setup(t,{emit:m}){const d=e.ref(!1),u=e.ref(0);e.watch(()=>t.table.list,()=>{if(t.formData.totalCount>0){let s=Math.ceil(t.formData.totalCount/t.formData.pageSize);t.formData.pageIndex>s&&(t.formData.pageIndex=s)}t.formData.pageSize>0&&t.formData.pageIndex>0?u.value=t.formData.pageSize*(t.formData.pageIndex-1)+1:u.value=1},{immediate:!0});const k=e.computed(()=>typeof t.form.foldNum!="number"||t.form.foldNum<=0?!1:t.form.list.filter(h=>!(h.type==="button"||h.fold===!1)).length>t.form.foldNum-1),b=e.computed(()=>{const s={transition:"0.5s","-webkit-transition":"0.5s"},h={transform:"rotate(180deg)","-webkit-transform":"rotate(180deg)"};return d.value?{...s,...h}:s});function f(){d.value=!d.value,m("handle-expand",d.value)}function p(s,h){return typeof t.form.foldNum!="number"||t.form.foldNum<=0||s.type==="button"||s.fold===!1||d.value?!0:h<=t.form.foldNum-1}function y(s){t.formData[s.startKey]=t.formData[s.key]?t.formData[s.key][0]:"",t.formData[s.endKey]=t.formData[s.key]?t.formData[s.key][1]:""}function w(s){t.formData.pageIndex=1,t.formData.pageSize=s,m("update:formData",t.formData),m("get-list")}async function C(s){t.formData.pageIndex=s,m("update:formData",t.formData),m("get-list")}return{tableIndex:u,isExpand:d,showFold:k,svgStyle:b,handleExpand:f,showFormItem:p,getDate:y,handleSizeChange:w,handleCurrentChange:C}}}),F=(t,m)=>{const d=t.__vccOpts||t;for(const[u,k]of m)d[u]=k;return d},I={class:"ele-easy-table",style:{overflow:"hidden"}},$={key:0,style:{"text-align":"center"}},T=[e.createElementVNode("g",{"fill-rule":"evenodd"},[e.createElementVNode("path",{d:"M24 21.91l10.586-10.586a2 2 0 0 1 2.828 2.828l-12 12a2 2 0 0 1-2.828 0l-12-12a2 2 0 0 1 2.828-2.828L24 21.91zm-10.586 1.414L24 33.91l10.586-10.586a2 2 0 0 1 2.828 2.828l-12 12a2 2 0 0 1-2.828 0l-12-12a2 2 0 0 1 2.828-2.828z","fill-rule":"nonzero"})],-1)],z={key:1},L={key:0},O={key:1},U=["innerHTML"],j={key:2},A={key:3},M={key:2,style:{float:"right",margin:"20px 0"}};function K(t,m,d,u,k,b){const f=e.resolveComponent("el-date-picker"),p=e.resolveComponent("el-input"),y=e.resolveComponent("el-option"),w=e.resolveComponent("el-select"),C=e.resolveComponent("el-button"),s=e.resolveComponent("el-form-item"),h=e.resolveComponent("el-form"),E=e.resolveComponent("el-table-column"),V=e.resolveComponent("el-table"),D=e.resolveComponent("el-pagination"),N=e.resolveDirective("loading");return e.openBlock(),e.createElementBlock("div",I,[Object.keys(t.form).length>0?(e.openBlock(),e.createBlock(h,e.mergeProps({key:0,class:t.form.class,inline:!0,model:t.formData,style:{position:"relative",...t.form.style}},t.form.config),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.form.list,(l,c)=>e.withDirectives((e.openBlock(),e.createElementBlock("span",{key:c},[l.type!=="slot"?(e.openBlock(),e.createBlock(s,e.mergeProps({key:0,label:l.label?l.label+"：":""},l.formConfig),{default:e.withCtx(()=>[l.type==="datePicker"?(e.openBlock(),e.createBlock(f,e.mergeProps({key:0,style:l.style||t.form.formItemStyle,onChange:r=>t.getDate(l),"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"daterange"},l.config,{modelValue:t.formData[l.key],"onUpdate:modelValue":r=>t.formData[l.key]=r,"value-format":"yyyy-MM-dd"}),null,16,["style","onChange","modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),l.type==="input"?(e.openBlock(),e.createBlock(p,e.mergeProps({key:1,placeholder:l.placeholder?l.placeholder:"请输入"+l.label,style:l.style||t.form.formItemStyle,onKeyup:m[0]||(m[0]=e.withKeys(r=>t.$emit("get-list"),["enter","native"]))},l.config,{modelValue:t.formData[l.key],"onUpdate:modelValue":r=>t.formData[l.key]=r}),null,16,["placeholder","style","modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),l.type==="select"?(e.openBlock(),e.createBlock(w,e.mergeProps({key:2,placeholder:l.placeholder?l.placeholder:"请选择"+l.label,style:l.style||t.form.formItemStyle},l.config,{modelValue:t.formData[l.key],"onUpdate:modelValue":r=>t.formData[l.key]=r}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.options,r=>(e.openBlock(),e.createBlock(y,{key:typeof r.value<"u"?r.value:r,label:typeof r.label<"u"?r.label:r,value:typeof r.value<"u"?r.value:r},null,8,["label","value"]))),128))]),_:2},1040,["placeholder","style","modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),l.type==="button"?(e.openBlock(),e.createBlock(C,e.mergeProps({key:3,disabled:l.disabled?l.disabled():!1,style:l.style,onClick:r=>l.handleClick(l,c),type:"primary"},l.config),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(typeof l.text=="function"?l.text():l.text),1)]),_:2},1040,["disabled","style","onClick"])):e.createCommentVNode("",!0)]),_:2},1040,["label"])):e.renderSlot(t.$slots,l.slot,{key:1})])),[[e.vShow,t.showFormItem(l,c)]])),128)),t.showFold?(e.openBlock(),e.createElementBlock("div",$,[e.createVNode(C,{onClick:m[1]||(m[1]=l=>t.handleExpand()),type:"primary",link:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.isExpand?"收起":"展开")+" ",1),(e.openBlock(),e.createElementBlock("svg",{style:e.normalizeStyle(t.svgStyle),fill:"#409EFF",height:"12px",viewBox:"0 0 48 48",width:"12px"},T,4))]),_:1})])):e.createCommentVNode("",!0)]),_:3},16,["class","model","style"])):e.createCommentVNode("",!0),Object.keys(t.table).length>0?e.withDirectives((e.openBlock(),e.createBlock(V,e.mergeProps({key:1,data:t.table.list,border:"","element-loading-text":"拼命加载中",stripe:"",style:{overflow:"visible","margin-top":"20px"},"tooltip-effect":"light"},t.$attrs),{default:e.withCtx(()=>[t.table.selection&&t.table.selection.show&&t.table.list.length>0?(e.openBlock(),e.createBlock(E,e.mergeProps({key:0,align:"center",type:"selection"},t.table.selection.config),null,16)):e.createCommentVNode("",!0),t.table.showIndex!==!1?(e.openBlock(),e.createBlock(E,{key:1,fixed:t.table.indexFixed||!1,label:t.table.indexLabel||"序号",align:"center",type:"index",index:t.tableIndex,width:"55"},null,8,["fixed","label","index"])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.table.columns,l=>(e.openBlock(),e.createBlock(E,e.mergeProps({key:l.key+l.label,label:l.label,prop:l.key,align:"center"},l.config),{header:e.withCtx(c=>[l.header?e.renderSlot(t.$slots,l.header,{key:0,row:c.row}):(e.openBlock(),e.createElementBlock("span",z,e.toDisplayString(l.label),1))]),default:e.withCtx(c=>[l.hasOwnProperty("type")?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",L,e.toDisplayString(c.row[l.key]),1)),l.type==="format"?(e.openBlock(),e.createElementBlock("span",O,[e.createElementVNode("span",{innerHTML:l.format(c.row,c)},null,8,U)])):e.createCommentVNode("",!0),l.type==="textBtn"?(e.openBlock(),e.createElementBlock("span",j,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.textBtn,(r,a)=>(e.openBlock(),e.createElementBlock("span",{key:a},[r.text||r.funcText(c.row,c)?(e.openBlock(),e.createBlock(C,e.mergeProps({key:0,onClick:n=>r.handleClick(c.row,c),style:{"margin-right":"10px"},type:"primary",link:""},r.config||r.funcConfig?r.funcConfig(c.row,c):{},{innerHTML:r.text||r.funcText(c.row,c)}),null,16,["onClick","innerHTML"])):e.createCommentVNode("",!0)]))),128))])):e.createCommentVNode("",!0),l.type==="slot"?(e.openBlock(),e.createElementBlock("span",A,[e.renderSlot(t.$slots,l.slot,{row:c.row})])):e.createCommentVNode("",!0)]),_:2},1040,["label","prop"]))),128))]),_:3},16,["data"])),[[N,t.table.isLoading]]):e.createCommentVNode("",!0),Object.keys(t.table).length>0&&t.pagination&&Array.isArray(t.table.list)&&t.table.list.length>0?(e.openBlock(),e.createElementBlock("div",M,[e.createVNode(D,e.mergeProps({"current-page":t.formData.pageIndex||1,layout:typeof t.pagination=="object"?t.pagination.layout:"total, sizes, prev, pager, next, jumper","page-size":t.formData.pageSize||10,"page-sizes":typeof t.pagination=="object"?t.pagination.pageSizes:[10,20,50,100],total:11,onCurrentChange:t.handleCurrentChange,onSizeChange:t.handleSizeChange},typeof t.pagination=="object"?t.pagination:{}),null,16,["current-page","layout","page-size","page-sizes","onCurrentChange","onSizeChange"])])):e.createCommentVNode("",!0)])}const H=F(x,[["render",K]]),q={class:"custom-column-wrapper"},P={class:"custom-column-title-wrapper"},J=e.createElementVNode("div",{class:"custom-column-title"},"自定义列",-1),G=e.createElementVNode("span",{class:"custom-column-search"},"搜索列：",-1),W={class:"text-center",slot:"footer"},Q=[e.createElementVNode("p",{class:"text-center custom-column-search"},"暂无列数据",-1)],R=e.defineComponent({name:"CustomColumn"}),X=e.defineComponent({...R,props:{localName:null,show:{type:Boolean,default:!1},baseColumns:null,columns:null,defaultColumns:null},emits:["update:show","update:columns"],setup(t,{emit:m}){const d=t,u=e.ref(""),k=e.ref(!1),b=e.ref(!0),f=e.ref([]),p=e.ref([]),y=e.ref([]),w=e.ref([]),C=e.ref(!1);e.watch(()=>d.show,a=>{a&&D(),k.value=a},{immediate:!0}),e.watch(k,a=>{m("update:show",a)});function s(a,n){const o=window.JSON.stringify(n);window.localStorage.setItem(a,o)}function h(a){const n=window.localStorage.getItem(a);if(!n)return"";try{return window.JSON.parse(n)}catch{window.localStorage.removeItem(a),window.location.reload()}}function E(a=""){p.value=f.value.filter(n=>n.label.toUpperCase().includes(a.toUpperCase())).map(n=>n.key),r()}async function V(){var n;let a=h(d.localName)||d.defaultColumns||[];if(Array.isArray(a)&&a.length>0){let o=[],B;return a.forEach((g,Y)=>{var _;B=(_=d.baseColumns)==null?void 0:_.find(Z=>Z.key===g),B&&B.key?o.push(B):a.splice(Y,1)}),(n=d.baseColumns)==null||n.forEach(g=>{a.includes(g.key)||f.value.push(g)}),f.value=o.concat(f.value),w.value=f.value.filter(g=>g.disabledCustom).map(g=>g.key),p.value=f.value.map(g=>g.key),await e.nextTick(),m("update:columns",o),s(d.localName,a)}d.baseColumns&&(f.value=d.baseColumns),w.value=f.value.filter(o=>o.disabledCustom).map(o=>o.key),p.value=f.value.map(o=>o.key),m("update:columns",d.baseColumns)}function D(){u.value="",E(u.value),d.columns&&(y.value=d.columns.map(a=>a.key)),r()}function N(){k.value=!1}async function l(){let a=[],n=[];f.value.forEach(o=>{y.value.includes(o.key)&&(a.push(o),n.push(o.key))}),s(d.localName,n),m("update:columns",[]),await e.nextTick(),m("update:columns",a),k.value=!1}function c(a){const n=a?p.value:p.value.filter(o=>!w.value.includes(o));y.value=a?y.value=[...new Set([...y.value,...n])]:y.value.filter(o=>!n.includes(o)),r()}function r(){b.value=p.value.every(a=>y.value.includes(a)),C.value=!b.value&&p.value.some(a=>y.value.includes(a))}return V(),(a,n)=>(e.openBlock(),e.createElementBlock("div",q,[e.createVNode(e.unref(i.ElDialog),{modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=o=>k.value=o),"show-close":!1,width:"880px"},{header:e.withCtx(()=>[e.createElementVNode("div",P,[J,G,e.createVNode(e.unref(i.ElInput),{onInput:E,placeholder:"请输入列名称",style:{width:"200px"},modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=o=>u.value=o)},null,8,["modelValue"])])]),default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",null,[e.createVNode(e.unref(i.ElCheckbox),{indeterminate:C.value,onChange:c,modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=o=>b.value=o)},{default:e.withCtx(()=>[e.createTextVNode("全选")]),_:1},8,["indeterminate","modelValue"]),e.createVNode(e.unref(i.ElCheckboxGroup),{onChange:r,modelValue:y.value,"onUpdate:modelValue":n[3]||(n[3]=o=>y.value=o)},{default:e.withCtx(()=>[e.createVNode(e.unref(S),{animation:166,group:{name:"customColumn"},class:"el-checkbox-wrapper",ghostClass:"ghost",handle:".el-checkbox__label","item-key":"key",tag:"ul",modelValue:f.value,"onUpdate:modelValue":n[2]||(n[2]=o=>f.value=o)},{item:e.withCtx(({element:o})=>[e.createElementVNode("li",null,[e.withDirectives((e.openBlock(),e.createBlock(e.unref(i.ElCheckbox),{disabled:o.disabledCustom,key:o.key,label:o.key},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.label),1)]),_:2},1032,["disabled","label"])),[[e.vShow,p.value.includes(o.key)]])])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e.createElementVNode("div",W,[e.createVNode(e.unref(i.ElButton),{onClick:n[4]||(n[4]=o=>N())},{default:e.withCtx(()=>[e.createTextVNode("取 消")]),_:1}),e.createVNode(e.unref(i.ElButton),{onClick:n[5]||(n[5]=o=>l()),type:"primary"},{default:e.withCtx(()=>[e.createTextVNode("确 定")]),_:1})])],512),[[e.vShow,p.value.length>0]]),e.withDirectives(e.createElementVNode("div",null,Q,512),[[e.vShow,p.value.length===0]])]),_:1},8,["modelValue"])]))}}),te="";return{install:t=>{t.component("EleEasyTable",H),t.component("CustomColumn",X)}}});
